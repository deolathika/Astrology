"use strict";(()=>{var D={};D.id=3712,D.ids=[3712],D.modules={20399:D=>{D.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:D=>{D.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},91943:(D,u,e)=>{e.r(u),e.d(u,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>E,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c});var s={};e.r(s),e.d(s,{GET:()=>C,POST:()=>F});var t=e(49303),r=e(88716),n=e(60670),a=e(87070);class i{async sendMessage(D,u,e,s=!1){if(!s)throw Error("Consent required for community chat");if(!this.isValidEmoji(e))throw Error("Invalid emoji - only approved emojis allowed");let t={id:this.generateId(),fromId:D,toId:u,body:e,emojiOnly:!0,queued:!1,createdAt:new Date().toISOString(),reactions:[],isModerated:!1};return this.moderationQueue.push(t),this.isSafeEmoji(e)&&(t.isModerated=!0,this.addMessageToChat(t)),t}async addReaction(D,u,e){if(!this.isValidEmoji(e))return!1;let s=this.findMessage(D);return!!s&&(s.reactions=s.reactions.filter(D=>D.userId!==u),s.reactions.push({emoji:e,userId:u,timestamp:new Date().toISOString()}),!0)}getChatHistory(D,u){let e=this.getChatKey(D,u);return this.messages.get(e)||[]}getOnlineUsers(){return Array.from(this.users.values()).filter(D=>D.isOnline)}updateConsent(D,u){this.consent.set(D,u)}hasConsent(D){let u=this.consent.get(D);return u?.chatEnabled||!1}discoverConnections(D,u){return this.users.get(D)?Array.from(this.users.values()).filter(u=>u.id!==D&&u.consentGiven&&!u.isBlocked).filter(D=>!u.zodiacSigns||!(u.zodiacSigns.length>0)||u.zodiacSigns.includes(D.zodiacSign)).slice(0,10):[]}moderateMessages(){let D=[],u=[];for(let e of this.moderationQueue)this.isSafeMessage(e)?(e.isModerated=!0,this.addMessageToChat(e),D.push(e)):u.push(e);return this.moderationQueue=[],D}getModerationQueue(){return this.moderationQueue}blockUser(D,u){let e=this.users.get(D);e&&(e.isBlocked=!0)}reportMessage(D,u){let e=this.findMessage(D);e&&this.moderationQueue.push(e)}getCommunityStats(){let D=this.users.size;return{totalUsers:D,onlineUsers:Array.from(this.users.values()).filter(D=>D.isOnline).length,totalMessages:Array.from(this.messages.values()).flat().length,pendingModeration:this.moderationQueue.length}}isValidEmoji(D){return this.allowedEmojis.includes(D)}isSafeEmoji(D){return["\uD83D\uDE0A","\uD83D\uDE04","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE09","\uD83D\uDE0E","\uD83E\uDD17","❤️","\uD83D\uDC95","\uD83D\uDC96","\uD83D\uDC97","\uD83D\uDC99","\uD83D\uDC9A","\uD83D\uDC9B","\uD83E\uDDE1","\uD83D\uDC9C","✨","\uD83C\uDF1F","⭐","\uD83C\uDF19","☀️","\uD83C\uDF08","\uD83D\uDD25","\uD83D\uDCA7","\uD83C\uDF0A","\uD83C\uDF31","\uD83C\uDF38","\uD83C\uDF3A","\uD83C\uDF3B","\uD83C\uDF37","\uD83C\uDF39","\uD83C\uDF40","\uD83C\uDF3F","\uD83C\uDF3E","\uD83D\uDC4D","\uD83D\uDC4F","\uD83D\uDE4C","\uD83E\uDD1D"].includes(D)}isSafeMessage(D){return this.isSafeEmoji(D.body)}addMessageToChat(D){let u=this.getChatKey(D.fromId,D.toId),e=this.messages.get(u)||[];e.push(D),this.messages.set(u,e)}getChatKey(D,u){return[D,u].sort().join("_")}findMessage(D){for(let u of this.messages.values()){let e=u.find(u=>u.id===D);if(e)return e}return null}generateId(){return Math.random().toString(36).substr(2,9)}constructor(){this.messages=new Map,this.users=new Map,this.consent=new Map,this.moderationQueue=[],this.allowedEmojis=["\uD83D\uDE0A","\uD83D\uDE04","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE09","\uD83D\uDE0E","\uD83E\uDD17","\uD83E\uDD14","\uD83D\uDE0C","\uD83D\uDE34","\uD83D\uDE0B","\uD83E\uDD24","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE14","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE24","\uD83D\uDE21","\uD83E\uDD2F","\uD83D\uDE31","\uD83D\uDE28","\uD83D\uDE30","\uD83D\uDE33","\uD83E\uDD2A","\uD83D\uDE1C","\uD83D\uDE1D","\uD83E\uDD28","\uD83E\uDDD0","\uD83E\uDD13","\uD83D\uDE07","\uD83E\uDD20","\uD83E\uDD73","\uD83E\uDD29","\uD83D\uDE3B","\uD83E\uDD17","\uD83E\uDD1D","\uD83D\uDC4F","\uD83D\uDE4C","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC95","\uD83D\uDC96","\uD83D\uDC97","\uD83D\uDC99","\uD83D\uDC9A","\uD83D\uDC9B","\uD83E\uDDE1","\uD83D\uDC9C","\uD83D\uDDA4","\uD83E\uDD0D","\uD83D\uDC94","\uD83D\uDCAF","✨","\uD83C\uDF1F","⭐","\uD83C\uDF19","☀️","\uD83C\uDF08","\uD83D\uDD25","\uD83D\uDCA7","\uD83C\uDF0A","\uD83C\uDF31","\uD83C\uDF38","\uD83C\uDF3A","\uD83C\uDF3B","\uD83C\uDF37","\uD83C\uDF39","\uD83C\uDF40","\uD83C\uDF3F","\uD83C\uDF3E","\uD83C\uDF35","\uD83C\uDF32","\uD83C\uDF33","\uD83C\uDF34","\uD83C\uDF30","\uD83C\uDF4E","\uD83C\uDF4A","\uD83C\uDF4B","\uD83C\uDF4C","\uD83C\uDF49","\uD83C\uDF47","\uD83C\uDF53","\uD83C\uDF52","\uD83C\uDF51","\uD83E\uDD6D","\uD83C\uDF4D","\uD83E\uDD65","\uD83E\uDD5D","\uD83C\uDF45","\uD83E\uDD55","\uD83C\uDF3D","\uD83C\uDF36️","\uD83E\uDD52","\uD83E\uDD6C","\uD83E\uDD66","\uD83C\uDF44","\uD83E\uDD5C","\uD83C\uDF30","\uD83C\uDF5E","\uD83E\uDD50","\uD83E\uDD56","\uD83E\uDD68","\uD83E\uDD6F","\uD83E\uDDC0","\uD83E\uDD5A","\uD83C\uDF73","\uD83E\uDD5E","\uD83E\uDDC7","\uD83E\uDD53","\uD83E\uDD69","\uD83C\uDF57","\uD83C\uDF56","\uD83E\uDDB4","\uD83C\uDF2D","\uD83C\uDF54","\uD83C\uDF5F","\uD83C\uDF55","\uD83E\uDD6A","\uD83E\uDD59","\uD83C\uDF2E","\uD83C\uDF2F","\uD83E\uDD57","\uD83E\uDD58","\uD83C\uDF5D","\uD83C\uDF5C","\uD83C\uDF72","\uD83C\uDF5B","\uD83C\uDF63","\uD83C\uDF71","\uD83E\uDD5F","\uD83C\uDF64","\uD83C\uDF59","\uD83C\uDF5A","\uD83C\uDF58","\uD83C\uDF65","\uD83E\uDD60","\uD83C\uDF62","\uD83C\uDF61","\uD83C\uDF67","\uD83C\uDF68","\uD83C\uDF66","\uD83E\uDD67","\uD83E\uDDC1","\uD83C\uDF70","\uD83C\uDF82","\uD83C\uDF6E","\uD83C\uDF6D","\uD83C\uDF6C","\uD83C\uDF6B","\uD83C\uDF69","\uD83C\uDF6A","\uD83C\uDF30","\uD83E\uDD5C","\uD83C\uDF6F","\uD83E\uDD5B","\uD83C\uDF7C","☕","\uD83C\uDF75","\uD83E\uDD64","\uD83C\uDF76","\uD83C\uDF7A","\uD83C\uDF7B","\uD83E\uDD42","\uD83C\uDF77","\uD83E\uDD43","\uD83C\uDF78","\uD83C\uDF79","\uD83E\uDDCA","\uD83E\uDD44","\uD83C\uDF74","\uD83C\uDF7D️","\uD83E\uDD62","\uD83D\uDD2A","\uD83C\uDFFA","\uD83C\uDF0D","\uD83C\uDF0E","\uD83C\uDF0F","\uD83C\uDF10","\uD83D\uDDFA️","\uD83E\uDDED","\uD83C\uDFD4️","⛰️","\uD83C\uDF0B","\uD83D\uDDFB","\uD83C\uDFD5️","⛺","\uD83C\uDFE0","\uD83C\uDFE1","\uD83C\uDFD8️","\uD83C\uDFDA️","\uD83C\uDFD7️","\uD83C\uDFED","\uD83C\uDFE2","\uD83C\uDFEC","\uD83C\uDFE3","\uD83C\uDFE4","\uD83C\uDFE5","\uD83C\uDFE6","\uD83C\uDFE8","\uD83C\uDFEA","\uD83C\uDFEB","\uD83C\uDFE9","\uD83D\uDC92","\uD83C\uDFDB️","⛪","\uD83D\uDD4C","\uD83D\uDD4D","\uD83D\uDD4B","⛩️","\uD83D\uDEE4️","\uD83D\uDEE3️","\uD83D\uDDFE","\uD83C\uDF91","\uD83C\uDFDE️","\uD83C\uDF05","\uD83C\uDF04","\uD83C\uDF20","\uD83C\uDF0C","⛅","⛈️","\uD83C\uDF24️","\uD83C\uDF26️","\uD83C\uDF27️","⛈️","\uD83C\uDF29️","\uD83C\uDF28️","❄️","☃️","⛄","\uD83C\uDF2C️","\uD83D\uDCA8","\uD83D\uDCA7","\uD83D\uDCA6","☔","☂️","\uD83C\uDF0A","\uD83C\uDF2B️"]}}let o=new i;async function C(D){try{let{searchParams:u}=new URL(D.url);switch(u.get("action")){case"discover_connections":return u.get("userZodiac"),parseInt(u.get("limit")||"10"),a.NextResponse.json({success:!0,connections:[{id:"1",name:"Cosmic Soul",zodiac:"Leo",compatibility:85,lastSeen:"2 hours ago"},{id:"2",name:"Star Gazer",zodiac:"Aries",compatibility:92,lastSeen:"1 hour ago"},{id:"3",name:"Moon Child",zodiac:"Cancer",compatibility:78,lastSeen:"30 mins ago"}]});case"get_recent_messages":parseInt(u.get("limit")||"20");let e=[{id:"1",user:"Cosmic Soul",message:"\uD83C\uDF1F✨",timestamp:new Date().toISOString()},{id:"2",user:"Star Gazer",message:"\uD83C\uDF19\uD83D\uDCAB",timestamp:new Date().toISOString()},{id:"3",user:"Moon Child",message:"\uD83C\uDF3A\uD83C\uDF38",timestamp:new Date().toISOString()}];return a.NextResponse.json({success:!0,messages:e});default:return a.NextResponse.json({error:"Invalid action"},{status:400})}}catch(D){return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function F(D){try{let{action:u,data:e}=await D.json();switch(u){case"send_message":let s=await o.sendMessage(e.fromId,e.toId,e.emoji,e.consentGiven);return a.NextResponse.json({success:!0,message:s});case"add_reaction":let t=await o.addReaction(e.messageId,e.userId,e.emoji);return a.NextResponse.json({success:t});case"update_consent":return o.updateConsent(e.userId,e.consent),a.NextResponse.json({success:!0});case"discover_connections":let r=o.discoverConnections(e.userId,e.preferences);return a.NextResponse.json({success:!0,connections:r});case"moderate_messages":let n=o.moderateMessages();return a.NextResponse.json({success:!0,moderated:n});case"block_user":return o.blockUser(e.userId,e.blockedUserId),a.NextResponse.json({success:!0});case"report_message":return o.reportMessage(e.messageId,e.reason),a.NextResponse.json({success:!0});default:return a.NextResponse.json({error:"Invalid action"},{status:400})}}catch(D){return a.NextResponse.json({error:"Chat operation failed"},{status:500})}}let E=new t.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/community/chat/route",pathname:"/api/community/chat",filename:"route",bundlePath:"app/api/community/chat/route"},resolvedPagePath:"/Users/lathikadissanayaka/P E R S O N A L/daily_secrets_app/src/app/api/community/chat/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:l}=E,m="/api/community/chat/route";function h(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}}};var u=require("../../../../webpack-runtime.js");u.C(D);var e=D=>u(u.s=D),s=u.X(0,[9276,5972],()=>e(91943));module.exports=s})();