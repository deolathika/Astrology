"use strict";(()=>{var t={};t.id=7996,t.ids=[7996],t.modules={20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},98685:(t,e,i)=>{i.r(e),i.d(e,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var r={};i.r(r),i.d(r,{POST:()=>u});var n=i(49303),a=i(88716),s=i(60670),o=i(87070);class c{async initialize(){if(!this.isInitialized)try{let{loadStripe:t}=await i.e(468).then(i.bind(i,30468));if(this.stripe=await t(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY),!this.stripe)throw Error("Failed to load Stripe");this.initializeProducts(),this.isInitialized=!0}catch(t){throw Error("Stripe initialization failed")}}async createPaymentIntent(t,e,i={}){this.isInitialized||await this.initialize();let r=this.products.find(e=>e.id===t);if(!r)throw Error("Product not found");try{let n=await fetch("/api/payments/create-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:t,userId:e,amount:r.price,currency:r.currency,metadata:i})});return await n.json()}catch(t){throw Error("Payment intent creation failed")}}async createSubscription(t,e,i){this.isInitialized||await this.initialize();try{let r=await fetch("/api/payments/create-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:t,userId:e,paymentMethodId:i})});return await r.json()}catch(t){throw Error("Subscription creation failed")}}async processDonation(t,e,i,r,n=!1){this.isInitialized||await this.initialize();try{let a=await fetch("/api/payments/donate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t,userId:e,toPool:i,message:r,anonymous:n})});return await a.json()}catch(t){throw Error("Donation processing failed")}}async confirmPayment(t){if(!this.stripe)throw Error("Stripe not initialized");try{let{error:e}=await this.stripe.confirmPayment({clientSecret:t});if(e)return{success:!1,error:e.message};return{success:!0}}catch(t){return{success:!1,error:"Payment confirmation failed"}}}async cancelSubscription(t){try{return(await fetch("/api/payments/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:t})})).ok}catch(t){return!1}}async getUserSubscriptions(t){try{let e=await fetch(`/api/payments/subscriptions?userId=${t}`);return(await e.json()).subscriptions||[]}catch(t){return[]}}async getDonationHistory(t){try{let e=await fetch(`/api/payments/donations?userId=${t}`);return(await e.json()).donations||[]}catch(t){return[]}}getProducts(){return this.products}getProduct(t){return this.products.find(e=>e.id===t)||null}initializeProducts(){this.products=[{id:"premium_unlock",name:"Premium Unlock",description:"Unlock all premium features",price:1e3,currency:"usd",type:"one_time",features:["Advanced astrology readings","Detailed numerology analysis","Dream interpretation","Compatibility reports","Priority support"],popular:!0},{id:"rectification_premium",name:"Birth Time Rectification",description:"Professional birth time rectification service",price:5e3,currency:"usd",type:"one_time",features:["Professional astrologer consultation","Detailed birth time analysis","Personalized report","Follow-up support"]},{id:"compatibility_report",name:"Compatibility Report",description:"Detailed relationship compatibility analysis",price:1e3,currency:"usd",type:"one_time",features:["Comprehensive compatibility analysis","Relationship insights","Communication tips","Long-term potential"]},{id:"yearly_pdf",name:"Yearly Cosmic Report",description:"Comprehensive yearly astrology report",price:1500,currency:"usd",type:"one_time",features:["Complete yearly forecast","Monthly breakdowns","Important dates","Personalized insights"]},{id:"meditation_pack",name:"Meditation Pack",description:"Guided meditation collection",price:500,currency:"usd",type:"one_time",features:["10 guided meditations","Chakra balancing","Stress relief","Sleep enhancement"]},{id:"cosmic_premium",name:"Cosmic Premium",description:"Monthly premium subscription",price:999,currency:"usd",type:"subscription",features:["All premium features","Daily personalized guidance","Priority support","Exclusive content","Community access"],popular:!0}]}formatPrice(t,e){return new Intl.NumberFormat("en-US",{style:"currency",currency:e.toUpperCase()}).format(t/100)}getStatus(){return{initialized:this.isInitialized,stripeLoaded:null!==this.stripe,productsCount:this.products.length}}constructor(){this.stripe=null,this.isInitialized=!1,this.products=[]}}let p=new c;async function u(t){try{let{productId:e,userId:i,amount:r,currency:n,metadata:a}=await t.json();if(!e||!i||!r)return o.NextResponse.json({error:"Product ID, User ID, and amount required"},{status:400});p.getStatus().initialized||await p.initialize();let s=await p.createPaymentIntent(e,i,a);return o.NextResponse.json({success:!0,paymentIntent:s,timestamp:new Date().toISOString()})}catch(t){return o.NextResponse.json({error:"Payment intent creation failed"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payments/create-intent/route",pathname:"/api/payments/create-intent",filename:"route",bundlePath:"app/api/payments/create-intent/route"},resolvedPagePath:"/Users/lathikadissanayaka/P E R S O N A L/daily_secrets_app/src/app/api/payments/create-intent/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y}=d,h="/api/payments/create-intent/route";function f(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}}};var e=require("../../../../webpack-runtime.js");e.C(t);var i=t=>e(e.s=t),r=e.X(0,[9276,5972],()=>i(98685));module.exports=r})();